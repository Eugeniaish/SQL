WITH transbymonth AS (
	SELECT 
		name, 
		EXTRACT(MONTH FROM occurred_at) AS order_month, 
		total_amt_usd
	FROM accounts
	JOIN orders ON accounts.id = orders.account_id
)
SELECT
	name,
	order_month,
	AVG(total_amt_usd) AS avg_total,
	CASE
		WHEN AVG(total_amt_usd) < 1000 THEN 'Low Volume'
		WHEN AVG(total_amt_usd) >= 1000 AND AVG(total_amt_usd) < 3000 THEN 'Medium Volume'
		ELSE 'High Volume'
	END AS status
FROM transbymonth
GROUP BY name, order_month
ORDER BY order_month, name;
Description:
Classifies each accountâ€™s average monthly order value into low, medium, or high volume.
